from fpdf import FPDF



import sqlite3 as mysql
import os,sys

from datetime import date


dir = os.path.split(sys.argv[0])[0]
Mydb=dir+'/poll.db'


if os.path.exists(Mydb):
    
    #pass
    print "eixts",Mydb
    
else:
    
    print "DB not existin"


class PDF(FPDF):
    
    # PDF class writes the details into a pdf file
    
    def __init__(self,orientation='P',unit='mm',format='A4'):
        
        FPDF.__init__(self)
        
        self.con=mysql.connect(Mydb)
        self.cur = self.con.cursor()       
        
    
    def footer(self):
        
        
        #sets a footer
        
        # Position at 1.5 cm from bottom
        self.set_y(-15)
        # Arial italic 8
        self.set_font('Arial','I',8)
        # Page number
        self.cell(0,10,'Result Generated by School EVM. Developed by Asif Kodur. Download from https://sourceforge.net/projects/evmachine/ ',0,0,'C')
                
                
        
    def Print(self,std,div):
        
        
        total_votes=0
        
        
        query='SELECT CANDIDATE, VOTE FROM poll WHERE STD=? AND DIV=?'
        self.cur.execute(query,(std,div))
        candidates=[]
        for each_cand in self.cur.fetchall():
            candidates.append([each_cand[0],each_cand[1]])
            try:
                total_votes+=int(each_cand[1])
            except:
                pass
        
       
        self.add_page()
        self.set_font('Arial','B',18)
        self.cell(0,10,"School Parliament Election Result",0,0,'C')
        
	
	today = date.today()
	d1 = today.strftime("%d/%m/%Y")

	self.ln(20)
        self.set_font('Arial',size=13)
        self.cell(10,10, "Poll Date:                          "+str(d1))

        self.ln(20)
        self.set_font('Arial',size=13)
        self.cell(10,10, "Class:                          "+std+" "+div)
        
        self.ln(20)
        self.set_font('Arial',size=13)
        self.cell(10,10,'Total Votes Polled:          '+str(total_votes))
        
        self.ln(20)
        self.cell(10,10,'Votes Won by Each Candidates')
        
        for cand in candidates:
            self.ln(20)
            self.cell(10,10,cand[0]+' '*20+str(cand[1]))
        
        

    def PrintConsolidated(self):
        
        
        query="SELECT DISTINCT STD,DIV FROM poll WHERE VOTE>0 ORDER BY STD,DIV"
        self.cur.execute(query)
        result=self.cur.fetchall()
        
        if result:
            
            for row in result:
                
                self.Print(row[0],row[1])
                
                
    
     
